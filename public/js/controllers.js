var helpenControllers=angular.module("helpenControllers",[]);helpenControllers.controller("LoginController",["$scope","User","Location",function($scope,User,Location){$scope.lat=40.1095828,$scope.lng=-88.2117322,navigator.geolocation.getCurrentPosition(function(pos){lat=pos.coords.latitude,lng=pos.coords.longitude,$scope.lat=lat,$scope.lng=lng},function(err){console.error("Error fetching gps coordinates.")},{enableHighAccuracy:!0,timeout:5e3,maximumAge:0});var build=Location.getLocationbyPosition($scope.lat,$scope.lng),building=build[0].ID;console.log($scope.lng),sessionStorage.setItem("location",building),console.log(sessionStorage.getItem("location")),$scope.login=function(){var id=$scope.username,pw=$scope.password;User.login(id,pw,building).then(function(resp){200==resp.status||201==resp.status?(sessionStorage.setItem("login",id),window.location.assign("/#/subjects")):(alert("Login failed"),console.log(resp))},function(resp){alert("Login failed"),console.log(resp)})},$scope.regUser=function(){window.location.assign("/#/register")}}]),helpenControllers.controller("RegisterController",["$scope","User",function($scope,User){$scope.regUser=function(){""!=$scope.username&&User.addUser($scope.username,$scope.password,$scope.name,$scope.email).then(function(resp){console.log(resp),alert("Success!")},function(resp){alert("User.addUser() failed"),console.log(resp)})}}]),helpenControllers.controller("SubjectController",["$scope","User","Subject",function($scope,User,Subject){var user=sessionStorage.getItem("login");(void 0===user||""==user||null==user)&&window.location.assign("/"),$scope.user=user,$scope.subjects=Subject.getSubjects(),$scope.declare=function(subject){Subject.setSubject($scope.user,subject).then(function(resp){console.log(resp),sessionStorage.setItem("Subject",subject),alert(subject+" has been set to your subject.")},function(resp){console.log(resp),alert("set failed")})}}]),helpenControllers.controller("FriendController",["$scope","User","Subject",function($scope,User,Subject){var user=sessionStorage.getItem("login");(void 0===user||""==user||null==user)&&window.location.assign("/"),$scope.user=user,$scope.subjects=Subject.getSubjects(),console.log(sessionStorage.getItem("Subject"));Subject.getPeoplefromSubject().then(function(resp){var data=resp.data.data,length=data.length,newdata=[],i=0;for(i=0;length>i;i++){var element=data[i];console.log(element),element.location==sessionStorage.getItem("location")&&element.subject==sessionStorage.getItem("Subject")&&newdata.push(element)}console.log(newdata),$scope.friends=newdata},function(resp){console.log("failure!")})}]),helpenControllers.controller("ReviewController",["$scope","Location",function($scope,Location){var user=sessionStorage.getItem("login");(void 0===user||""==user||null==user)&&window.location.assign("/"),$scope.user=user,$scope.places=Location.all()}]),helpenControllers.controller("ReviewDetailController",["$scope","$routeParams","Location","Review",function($scope,$routeParams,Location,Review){$scope.id=$routeParams.id,$scope.location=Location.getLocationByID($scope.id),console.log($scope.location),$scope.currat=0;var sock=new SockJS("http://helpenme.com:4000/chat/"+$routeParams.id);$scope.messages=[],$scope.sendMessage=function(){sock.send($scope.messageText),$scope.messageText=""},sock.onmessage=function(e){$scope.messages.push(e.data),$scope.$apply()},console.log($scope.id),$scope.review=function(){void 0==$scope.overall?($scope.overall="",alert("Invalid input!")):$scope.overall>10||$scope.overall<0?alert("Input out of range!"):Review.getReview($scope.id).then(function(resp){console.log(resp);var response=resp.data.data;console.log(response);var oldr=response.rating,oldc=response.numberOfParticipant;rating=oldr*oldc,rating+=parseInt($scope.overall);var number=response.numberOfParticipant+1;response.numberOfParticipant=number,rating/=number,response.rating=rating,$scope.currat=rating,Review.sendReview($scope.id,response.rating,response.numberOfParticipant).then(function(resp){console.log("success!"),console.log(resp)},function(resp){console.log("failure!")})},function(resp){Review.addreview($scope.id,$scope.overall,1).then(function(resp){console.log(resp),console.log("added")},function(resp){console.log(resp)})})}}]);